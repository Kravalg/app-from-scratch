**draft**

# Формы

Есть несколько способов работать с формами в web.

1. HTML формы, формируемые на backend. Подходит для простых случаев.
   Никаких автокомплитов, date-picker, вложенных форм и т.п.
2. HTML формы, формируемые на backend + js.
   Значительно лучше.
   Но в проект добавляется новая компонента - frontend, npm пакеты, система сборки.
   Появляются проблемы сериализации данных, например json не умеет сериализовывать даты.
   Сложно тестировать, т.к. это только интеграционные тесты с selenium и т.п.
3. Формы на js. Больше возможностей, сложнее формы. Но логика еще сильнее расползается
   между backend и frontend. Для специализированных или сложных форм это единстенное решение.

Выделю следующие проблемы:

1. Кроме backend появляется еще и frontend.
   Разработчик должен овладеть новыми инстументами
   или команда пополняется frontend разработчиком.
2. Возникают проблемы с передачей данных.
   Скажем, некоторые поля формы имют тип Date или Keyword.
   Приходится явно прописывать правила сериализации/десериализации.
3. Расползается логика, скажем в html добавили поле, а js - забыли.
4. Сложно тестировать.

Для типовых форм, которые, например, используются в админках можно решить эти проблемы.

В шаблон добавляется ссылка на js файл.
На страницу, где должна быть форма, backend разработчик добавляет декларативное
описание формы в виде данных.
При загрузке страницы движок форм считывает это описание и рендерит форму.
Для описания формы и обмена с backend используется формат
[transit](https://github.com/cognitect/transit-format).

Transit - формат, который использует json, т.к. браузер имеет встроенную оптимизированную поддержку json,
то сериализация/десериализация происходит очень быстро.
Transit поддерживает множество типов и может расширяться, по этому все clojure типы поддерживаются.
Реализации для [clj](https://github.com/cognitect/transit-clj)
и
[js](https://github.com/cognitect/transit-js).

Backend декларативно описывает из каких компонентов состоит форма:

```clojure
(ns publicator.web.forms.user.register
  (:require
   [publicator.web.routing :as routing]))

(defn description []
  {:widget :submit, :name "Зарегистрироваться"
   :url (routing/path-for :user.register/process), :method :post, :nested
   {:widget :group, :nested
    [:login {:widget :input, :label "Логин"}
     :full-name {:widget :input, :label "Полное имя"}
     :password {:widget :input, :label "Пароль", :type "password"}]}})

(defn build [initial-params]
  {:initial-data initial-params
   :errors       {}
   :description  (description)})
```
